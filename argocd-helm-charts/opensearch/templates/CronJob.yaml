{{- if .Values.backup.enable }}
apiVersion: batch/v1beta1
kind: CronJob
metadata:
  namespace: graylog
  name: backup-s3
spec:
  schedule: {{ .Values.backup.schedule | quote }}
  concurrencyPolicy: Forbid
  failedJobsHistoryLimit: 10
  successfulJobsHistoryLimit: 5
  startingDeadlineSeconds: 180
  suspend: false 
  jobTemplate:
    spec:
      template:
        metadata:
          labels:
            app: backup-s3 
        spec:       
          containers:
          - name: es-curator
            image: {{ .Values.backup.image }}
            imagePullPolicy: IfNotPresent 
            command:
              - docker-compose run --rm es-curator snapshot ALL {{ .Values.backup.target }} True
          restartPolicy: OnFailure
