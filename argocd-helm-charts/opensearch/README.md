# How to increase the ES index limit

## Sample issue which you see in graylog logs

```
[194]: index [graylog_2], type [_doc], id [938e8b50-2d32-11ec-b77c-0ad5e9494873], message [ElasticsearchException[Elasticsearch exception [type=illegal_argument_exception, reason=Limit of total fields [1000] has been exceeded]]]
```

## Solution

The issue is related to elasticseach settings and those are stored internally (in a settings index/db) and can only be adjusted via ES API request.
1. Login to the opensearch `opensearch-cluster-master-0` pod

2. Verify the existing setting of the index for which it is complaining. You can do so by running 
```sh
curl -u $username:$password -XGET http://localhost:9200/$index_name/_settings?pretty=true
```

3. Increase the limit by running - 
```sh
curl -u $username:$password -X PUT "http://localhost:9200/$index_num/_settings?pretty" -H 'Content-Type: application/json' -d'
 {
   "index" : {
     "mapping.total_fields.limit" : 2000
   }
 }'
```

NOTE: We should notice that this increases memory usage and differing field names SHOULD be avoided when possible. But with graylog, fields are generated by graylog - so not something we can do much about.


## Setting users and passwords

get a shell inside opensearch master pod, and run:
```
cd plugins/opensearch-security/tools
chmod +x hash.sh
./hash.sh NEWPASSWORD
# use the generate hash from above - when modifying internal_users.yml to suit your needs
vi /usr/share/opensearch/plugins/opensearch-security/securityconfig/internal_users.yml
../securityadmin.sh -cd ../securityconfig/ -icl -nhnv -cacert ../../../config/root-ca.pem -cert ../../../config/kirk.pem -key ../../../config/kirk-key.pem
```
